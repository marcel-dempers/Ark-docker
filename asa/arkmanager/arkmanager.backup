#!/bin/bash

instance=$1

if [ -z "$instance" ]
then
      echo "must supply instance, e.g @island"
      exit
fi

instance="${instance:1}"

datestamp="$(date +"%Y-%m-%d_%H.%M.%S")"
backupdir="${BACKUP_DIR}/${instance}-${datestamp}"
saverootdir="${ARK_DIR}/ShooterGame/Saved/SavedArks/TheIsland_WP"

echo "creating backup ${instance}... ${backupdir}"
mkdir -p ${backupdir}
cp -r ${saverootdir}/* ${backupdir}

backupfile="${backupdir}.bz2"
echo "compressing backup... ${backupfile}"
tar -jcf "${backupfile}" -C "${BACKUP_DIR}" "${instance}-${datestamp}"

if test -f /${HOME}/.s3cfg; then
  echo "s3cmd configured, uploading to S3 ..."
  s3cmd put ${backupfile} s3://ark-backups${backupfile}
fi